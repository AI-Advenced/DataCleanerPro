{% extends "base.html" %}

{% block title %}Accès refusé - DataCleaner-Pro{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center min-vh-100 align-items-center">
        <div class="col-md-6 text-center">
            <div class="error-illustration mb-4">
                <div class="error-icon-container">
                    <i class="fas fa-shield-alt fa-5x text-danger mb-3 error-bounce"></i>
                </div>
                <h1 class="display-1 fw-bold text-primary error-glitch">403</h1>
                <h2 class="h3 text-secondary mb-3">Accès Refusé</h2>
                <p class="text-muted mb-4 lead">
                    Désolé, vous n'avez pas les permissions nécessaires pour accéder à cette ressource.
                </p>
                
                <!-- Détails de l'erreur -->
                <div class="alert alert-danger bg-danger bg-opacity-10 border-danger mb-4">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-exclamation-triangle me-3 fs-4"></i>
                        <div class="text-start">
                            <strong>Erreur d'autorisation</strong>
                            <p class="mb-0 mt-1">
                                Cette page nécessite des privilèges spéciaux ou vous n'êtes pas autorisé à voir ce contenu.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Suggestions -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <i class="fas fa-user-check text-primary fa-2x mb-3"></i>
                                <h5>Vérifiez vos droits</h5>
                                <p class="text-muted small">
                                    Assurez-vous d'être connecté avec le bon compte et d'avoir les permissions requises.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100 border-info">
                            <div class="card-body">
                                <i class="fas fa-crown text-warning fa-2x mb-3"></i>
                                <h5>Compte Premium</h5>
                                <p class="text-muted small">
                                    Cette fonctionnalité nécessite peut-être un compte Premium.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Actions possibles -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
                <button onclick="history.back()" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Retour
                </button>
                
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    {% if not current_user.is_premium %}
                        <a href="/pricing" class="btn btn-warning">
                            <i class="fas fa-crown me-2"></i>Upgrade Premium
                        </a>
                    {% endif %}
                {% else %}
                    <a href="{{ url_for('auth.login') }}" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt me-2"></i>Se connecter
                    </a>
                {% endif %}
                
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                    <i class="fas fa-home me-2"></i>Accueil
                </a>
            </div>
            
            <!-- Aide -->
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-question-circle me-2"></i>Besoin d'aide ?
                    </h6>
                </div>
                <div class="card-body">
                    <p class="mb-3">Si vous pensez qu'il s'agit d'une erreur, voici ce que vous pouvez faire :</p>
                    
                    <div class="row text-start">
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-envelope text-primary me-2 mt-1"></i>
                                <div>
                                    <strong>Contactez le support</strong>
                                    <p class="small text-muted mb-0">
                                        <a href="mailto:support@datacleaner-pro.com" class="text-decoration-none">
                                            support@datacleaner-pro.com
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-comments text-success me-2 mt-1"></i>
                                <div>
                                    <strong>Chat en direct</strong>
                                    <p class="small text-muted mb-0">
                                        <button class="btn btn-link p-0 text-decoration-none" onclick="openChat()">
                                            Ouvrir le chat
                                        </button>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-book text-info me-2 mt-1"></i>
                                <div>
                                    <strong>Documentation</strong>
                                    <p class="small text-muted mb-0">
                                        <a href="/docs/permissions" class="text-decoration-none">
                                            Guide des permissions
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Détails techniques pour debug -->
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-secondary" type="button" 
                                data-bs-toggle="collapse" data-bs-target="#technicalDetails">
                            <i class="fas fa-code me-1"></i>Détails techniques
                        </button>
                        
                        <div class="collapse mt-2" id="technicalDetails">
                            <div class="bg-light p-3 rounded text-start">
                                <code class="small">
                                    Erreur: 403 Forbidden<br>
                                    URL: {{ request.url }}<br>
                                    Méthode: {{ request.method }}<br>
                                    Utilisateur: {% if current_user.is_authenticated %}{{ current_user.username }}{% else %}Anonyme{% endif %}<br>
                                    Timestamp: {{ moment().utc().format('YYYY-MM-DD HH:mm:ss') }} UTC<br>
                                    User-Agent: <span id="userAgent"></span><br>
                                    Référent: {{ request.referrer or 'Direct' }}
                                </code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Animation décorative -->
        <div class="col-md-4 d-none d-lg-block">
            <div class="text-center">
                <div class="forbidden-animation">
                    <div class="shield-container">
                        <i class="fas fa-shield-alt shield-main"></i>
                        <i class="fas fa-times shield-cross"></i>
                    </div>
                    <div class="floating-icons">
                        <i class="fas fa-lock floating-icon" style="--delay: 0s; --x: 20px; --y: -30px;"></i>
                        <i class="fas fa-key floating-icon" style="--delay: 1s; --x: -25px; --y: -20px;"></i>
                        <i class="fas fa-user-slash floating-icon" style="--delay: 2s; --x: 30px; --y: 20px;"></i>
                        <i class="fas fa-ban floating-icon" style="--delay: 1.5s; --x: -20px; --y: 25px;"></i>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h4 class="text-muted">Accès Restreint</h4>
                    <p class="text-muted">
                        Cette zone est protégée par des mesures de sécurité avancées.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Remplir les détails techniques
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('userAgent').textContent = navigator.userAgent;
    
    // Animation de l'icône d'erreur
    setTimeout(() => {
        document.querySelector('.error-bounce').classList.add('animate__animated', 'animate__bounce');
    }, 500);
    
    // Effet de glitch sur le code d'erreur
    setInterval(() => {
        const glitchElement = document.querySelector('.error-glitch');
        glitchElement.style.textShadow = `
            ${Math.random() * 10 - 5}px ${Math.random() * 10 - 5}px 0 #ff0000,
            ${Math.random() * 10 - 5}px ${Math.random() * 10 - 5}px 0 #00ff00,
            ${Math.random() * 10 - 5}px ${Math.random() * 10 - 5}px 0 #0000ff
        `;
        
        setTimeout(() => {
            glitchElement.style.textShadow = 'none';
        }, 100);
    }, 3000);
});

function openChat() {
    // Simulation d'ouverture du chat
    alert('Chat support non encore implémenté. Utilisez l\'email pour le moment.');
}

// Tentative de reconnexion automatique si déconnecté
if (!{{ 'true' if current_user.is_authenticated else 'false' }}) {
    setTimeout(() => {
        if (confirm('Voulez-vous vous connecter pour accéder à cette page ?')) {
            window.location.href = '{{ url_for("auth.login") }}?next=' + encodeURIComponent(window.location.pathname);
        }
    }, 5000);
}
</script>

<style>
.error-illustration {
    position: relative;
}

.error-icon-container {
    position: relative;
    display: inline-block;
}

.error-bounce {
    animation: errorBounce 2s infinite;
}

@keyframes errorBounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0,0,0);
    }
    40%, 43% {
        transform: translate3d(0, -15px, 0);
    }
    70% {
        transform: translate3d(0, -7px, 0);
    }
    90% {
        transform: translate3d(0, -2px, 0);
    }
}

.error-glitch {
    position: relative;
    animation: glitch 3s infinite;
}

@keyframes glitch {
    0% { transform: translate(0); }
    2% { transform: translate(2px, 0); }
    4% { transform: translate(-2px, 0); }
    6% { transform: translate(0); }
    8% { transform: translate(-1px, 0); }
    10% { transform: translate(1px, 0); }
    12% { transform: translate(0); }
    100% { transform: translate(0); }
}

.forbidden-animation {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 0 auto;
}

.shield-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 90px auto;
}

.shield-main {
    font-size: 6rem;
    color: #dc3545;
    animation: pulse 2s infinite;
}

.shield-cross {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    color: #ffffff;
    animation: crossRotate 3s infinite linear;
}

.floating-icons {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.floating-icon {
    position: absolute;
    font-size: 1.5rem;
    color: #6c757d;
    animation: float 4s ease-in-out infinite;
    animation-delay: var(--delay);
    left: calc(50% + var(--x));
    top: calc(50% + var(--y));
}

@keyframes pulse {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.1);
        opacity: 0.7;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes crossRotate {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

@keyframes float {
    0%, 100% {
        transform: translateY(0px);
        opacity: 0.7;
    }
    50% {
        transform: translateY(-20px);
        opacity: 1;
    }
}

.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

@media (max-width: 768px) {
    .display-1 {
        font-size: 4rem;
    }
    
    .forbidden-animation {
        width: 200px;
        height: 200px;
    }
    
    .shield-main {
        font-size: 4rem;
    }
    
    .shield-cross {
        font-size: 2rem;
    }
    
    .floating-icon {
        font-size: 1rem;
    }
}

/* Animation d'entrée */
.error-illustration {
    animation: fadeInUp 1s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}
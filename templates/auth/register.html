{% extends "base.html" %}

{% block title %}Inscription - DataCleaner-Pro{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center min-vh-100 align-items-center py-5">
        <div class="col-md-6">
            <div class="card border-0 shadow-lg">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                        <h2 class="fw-bold text-primary">Créer un compte</h2>
                        <p class="text-muted">Rejoignez DataCleaner-Pro gratuitement</p>
                    </div>
                    
                    <form method="POST" id="registerForm">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.first_name.label(class="form-label fw-semibold") }}
                                    {{ form.first_name(class="form-control") }}
                                    {% if form.first_name.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.first_name.errors %}
                                                <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.last_name.label(class="form-label fw-semibold") }}
                                    {{ form.last_name(class="form-control") }}
                                    {% if form.last_name.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.last_name.errors %}
                                                <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            {{ form.username.label(class="form-label fw-semibold") }}
                            {{ form.username(class="form-control", id="username") }}
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                3-80 caractères, lettres, chiffres et underscore uniquement
                            </div>
                            {% if form.username.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.username.errors %}
                                        <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.email.label(class="form-label fw-semibold") }}
                            {{ form.email(class="form-control", id="email") }}
                            {% if form.email.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.email.errors %}
                                        <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.password.label(class="form-label fw-semibold") }}
                            <div class="position-relative">
                                {{ form.password(class="form-control", id="password") }}
                                <button type="button" class="btn btn-link position-absolute end-0 top-0 me-2 mt-1" 
                                        onclick="togglePassword('password', 'toggleIcon1')" id="toggleBtn1">
                                    <i class="fas fa-eye" id="toggleIcon1"></i>
                                </button>
                            </div>
                            <div class="mt-2">
                                <div class="progress" style="height: 5px;">
                                    <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="passwordStrengthText">Force du mot de passe</small>
                            </div>
                            {% if form.password.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.password.errors %}
                                        <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.password2.label(class="form-label fw-semibold") }}
                            <div class="position-relative">
                                {{ form.password2(class="form-control", id="password2") }}
                                <button type="button" class="btn btn-link position-absolute end-0 top-0 me-2 mt-1" 
                                        onclick="togglePassword('password2', 'toggleIcon2')" id="toggleBtn2">
                                    <i class="fas fa-eye" id="toggleIcon2"></i>
                                </button>
                            </div>
                            <div class="mt-1" id="passwordMatchIndicator"></div>
                            {% if form.password2.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.password2.errors %}
                                        <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3 form-check">
                            {{ form.accept_terms(class="form-check-input", id="acceptTerms") }}
                            {{ form.accept_terms.label(class="form-check-label") }}
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#termsModal">
                                conditions d'utilisation
                            </a>
                            et la 
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#privacyModal">
                                politique de confidentialité
                            </a>
                            {% if form.accept_terms.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.accept_terms.errors %}
                                        <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small><br>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="d-grid mb-3">
                            {{ form.submit(class="btn btn-primary btn-lg", id="submitBtn") }}
                        </div>
                    </form>
                    
                    <hr>
                    
                    <div class="text-center">
                        <p class="mb-3">Ou inscrivez-vous avec :</p>
                        <button class="btn btn-outline-danger me-2" onclick="signupWithGoogle()">
                            <i class="fab fa-google me-2"></i>Google
                        </button>
                        <button class="btn btn-outline-primary" onclick="signupWithLinkedIn()">
                            <i class="fab fa-linkedin me-2"></i>LinkedIn
                        </button>
                    </div>
                    
                    <hr>
                    
                    <div class="text-center">
                        <p class="mb-0">
                            Déjà un compte ? 
                            <a href="{{ url_for('auth.login') }}" class="text-decoration-none fw-semibold">
                                Se connecter
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Avantages de l'inscription -->
            <div class="card border-0 mt-3">
                <div class="card-body">
                    <h6 class="text-center mb-3">Ce que vous obtenez gratuitement :</h6>
                    <div class="row text-center">
                        <div class="col-3">
                            <i class="fas fa-hdd text-primary fs-5"></i>
                            <p class="small mb-0 mt-1">1GB stockage</p>
                        </div>
                        <div class="col-3">
                            <i class="fas fa-table text-success fs-5"></i>
                            <p class="small mb-0 mt-1">5 datasets/mois</p>
                        </div>
                        <div class="col-3">
                            <i class="fas fa-chart-bar text-info fs-5"></i>
                            <p class="small mb-0 mt-1">Analyses de base</p>
                        </div>
                        <div class="col-3">
                            <i class="fas fa-headset text-warning fs-5"></i>
                            <p class="small mb-0 mt-1">Support 24/7</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Panneau d'informations -->
        <div class="col-md-4 offset-md-1 d-none d-md-block">
            <div class="text-center">
                <h3 class="fw-bold text-primary mb-4">Pourquoi DataCleaner-Pro ?</h3>
                
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-shrink-0 me-3">
                            <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                                 style="width: 50px; height: 50px;">
                                <i class="fas fa-rocket"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 text-start">
                            <h6 class="mb-1">Démarrage rapide</h6>
                            <small class="text-muted">Commencez à nettoyer vos données en moins de 5 minutes</small>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-shrink-0 me-3">
                            <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center"
                                 style="width: 50px; height: 50px;">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 text-start">
                            <h6 class="mb-1">Intelligence artificielle</h6>
                            <small class="text-muted">Algorithmes avancés pour un nettoyage optimal</small>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-shrink-0 me-3">
                            <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center"
                                 style="width: 50px; height: 50px;">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 text-start">
                            <h6 class="mb-1">Sécurité garantie</h6>
                            <small class="text-muted">Vos données sont protégées et cryptées</small>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-3">
                            <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center"
                                 style="width: 50px; height: 50px;">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 text-start">
                            <h6 class="mb-1">Communauté active</h6>
                            <small class="text-muted">Support et ressources de la communauté</small>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-success border-0">
                    <i class="fas fa-gift me-2"></i>
                    <strong>Offre spéciale :</strong> 14 jours d'essai Pro gratuit pour les nouveaux utilisateurs !
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Conditions d'utilisation -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Conditions d'utilisation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptation des conditions</h6>
                <p>En utilisant DataCleaner-Pro, vous acceptez ces conditions d'utilisation...</p>
                
                <h6>2. Description du service</h6>
                <p>DataCleaner-Pro est une plateforme de nettoyage et d'analyse de données...</p>
                
                <h6>3. Utilisation du service</h6>
                <ul>
                    <li>Vous devez être âgé d'au moins 13 ans</li>
                    <li>Vous êtes responsable de la sécurité de votre compte</li>
                    <li>Vous ne devez pas utiliser le service à des fins illégales</li>
                </ul>
                
                <h6>4. Confidentialité des données</h6>
                <p>Vos données sont traitées selon notre politique de confidentialité...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Politique de confidentialité -->
<div class="modal fade" id="privacyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Politique de confidentialité</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Collecte des données</h6>
                <p>Nous collectons uniquement les données nécessaires au fonctionnement du service...</p>
                
                <h6>Utilisation des données</h6>
                <p>Vos données personnelles sont utilisées pour :</p>
                <ul>
                    <li>Fournir et améliorer nos services</li>
                    <li>Communiquer avec vous</li>
                    <li>Assurer la sécurité de la plateforme</li>
                </ul>
                
                <h6>Partage des données</h6>
                <p>Nous ne vendons jamais vos données personnelles à des tiers...</p>
                
                <h6>Sécurité</h6>
                <p>Nous utilisons des mesures de sécurité avancées pour protéger vos données...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId, iconId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(iconId);
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        field.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

function signupWithGoogle() {
    alert('Fonctionnalité en cours de développement');
}

function signupWithLinkedIn() {
    alert('Fonctionnalité en cours de développement');
}

// Validation en temps réel et indicateurs visuels
document.addEventListener('DOMContentLoaded', function() {
    const usernameField = document.getElementById('username');
    const emailField = document.getElementById('email');
    const passwordField = document.getElementById('password');
    const password2Field = document.getElementById('password2');
    const strengthBar = document.getElementById('passwordStrength');
    const strengthText = document.getElementById('passwordStrengthText');
    const matchIndicator = document.getElementById('passwordMatchIndicator');
    const submitBtn = document.getElementById('submitBtn');
    
    // Validation nom d'utilisateur
    if (usernameField) {
        usernameField.addEventListener('input', function() {
            const username = this.value;
            const usernameRegex = /^[a-zA-Z0-9_]{3,80}$/;
            
            if (username.length >= 3 && usernameRegex.test(username)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else if (username.length > 0) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
            } else {
                this.classList.remove('is-invalid', 'is-valid');
            }
        });
    }
    
    // Validation email
    if (emailField) {
        emailField.addEventListener('blur', function() {
            const email = this.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email && emailRegex.test(email)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else if (email.length > 0) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
            } else {
                this.classList.remove('is-invalid', 'is-valid');
            }
        });
    }
    
    // Force du mot de passe
    if (passwordField && strengthBar && strengthText) {
        passwordField.addEventListener('input', function() {
            const password = this.value;
            const strength = calculatePasswordStrength(password);
            
            strengthBar.style.width = strength.percentage + '%';
            strengthBar.className = 'progress-bar ' + strength.class;
            strengthText.textContent = strength.text;
            strengthText.className = 'text-muted ' + strength.textClass;
            
            // Validation du champ
            if (password.length >= 8 && strength.score >= 3) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else if (password.length > 0) {
                this.classList.add('is-invalid');
                this.classList.remove('is-valid');
            } else {
                this.classList.remove('is-invalid', 'is-valid');
            }
            
            // Vérifier la correspondance si password2 a une valeur
            if (password2Field.value) {
                checkPasswordMatch();
            }
        });
    }
    
    // Correspondance des mots de passe
    if (password2Field && matchIndicator) {
        password2Field.addEventListener('input', checkPasswordMatch);
        
        function checkPasswordMatch() {
            const password = passwordField.value;
            const password2 = password2Field.value;
            
            if (password2.length > 0) {
                if (password === password2 && password.length >= 8) {
                    password2Field.classList.remove('is-invalid');
                    password2Field.classList.add('is-valid');
                    matchIndicator.innerHTML = '<small class="text-success"><i class="fas fa-check me-1"></i>Les mots de passe correspondent</small>';
                } else {
                    password2Field.classList.add('is-invalid');
                    password2Field.classList.remove('is-valid');
                    matchIndicator.innerHTML = '<small class="text-danger"><i class="fas fa-times me-1"></i>Les mots de passe ne correspondent pas</small>';
                }
            } else {
                password2Field.classList.remove('is-invalid', 'is-valid');
                matchIndicator.innerHTML = '';
            }
        }
    }
    
    function calculatePasswordStrength(password) {
        let score = 0;
        
        // Longueur
        if (password.length >= 8) score += 1;
        if (password.length >= 12) score += 1;
        
        // Complexité
        if (/[a-z]/.test(password)) score += 1;
        if (/[A-Z]/.test(password)) score += 1;
        if (/[0-9]/.test(password)) score += 1;
        if (/[^A-Za-z0-9]/.test(password)) score += 1;
        
        const strengths = [
            { score: 0, text: 'Très faible', class: 'bg-danger', textClass: 'text-danger', percentage: 20 },
            { score: 1, text: 'Faible', class: 'bg-danger', textClass: 'text-danger', percentage: 25 },
            { score: 2, text: 'Moyen', class: 'bg-warning', textClass: 'text-warning', percentage: 50 },
            { score: 3, text: 'Fort', class: 'bg-info', textClass: 'text-info', percentage: 75 },
            { score: 4, text: 'Très fort', class: 'bg-success', textClass: 'text-success', percentage: 90 },
            { score: 5, text: 'Excellent', class: 'bg-success', textClass: 'text-success', percentage: 100 }
        ];
        
        return { ...strengths[Math.min(score, 5)], score: score };
    }
});

// Animation d'entrée
document.addEventListener('DOMContentLoaded', function() {
    const card = document.querySelector('.card');
    card.style.opacity = '0';
    card.style.transform = 'translateY(50px)';
    
    setTimeout(() => {
        card.style.transition = 'all 0.5s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
    }, 100);
});
</script>

<style>
.min-vh-100 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.card {
    backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.95);
}

.progress-bar {
    transition: width 0.3s ease, background-color 0.3s ease;
}
</style>
{% endblock %}